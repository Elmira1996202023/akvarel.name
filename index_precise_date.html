<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Заявка — Акварель Dance</title>
<style>
  /* ====== PAGE SETUP (A4) ====== */
  @page { size: A4; margin: 18mm; }
  html, body { height: 100%; }
  body {
    margin: 0;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    font-family: "Times New Roman", Times, serif;
    color:#111;
  }
  .page { width: 210mm; min-height: calc(297mm - 36mm); margin: 0 auto; padding: 18mm; box-sizing: border-box; background: #fff; }

  /* ====== TYPO ====== */
  .small { font-size: 12pt; }
  .normal { font-size: 13pt; }
  .title { font-weight: bold; text-align: center; font-size: 16pt; margin: 8pt 0 3pt; }
  .subtitle { text-align:center; font-style: italic; font-size: 12.5pt; margin-bottom: 8pt; }
  .city { text-align:center; font-size: 12pt; margin-bottom: 10pt; }
  .right { text-align: right; }
  .muted { color:#444; }

  /* ====== HEADER ====== */
  .header-row { display:flex; justify-content: space-between; align-items: flex-start; }
  .header-right { text-align:right; font-size: 12pt; }
  .app-note { font-weight: bold; }
  .date-line { margin-top: 12pt; white-space: nowrap; }
  .line-input {
    display:inline-block;
    width: 50pt;
    border: none;
    border-bottom: 1px solid #000;
    outline: none;
    background: transparent;
    text-align: center;
    font: inherit;
    padding: 0 2pt 0 2pt;
  }
  .line-input.month { width: 90pt; text-align: left; }
  .line-input.year { width: 60pt; }

  /* ====== BLOCKS ====== */
  table { width:100%; border-collapse: collapse; }
  .block td, .block th, .block tr { border:1px solid #000; }
  .block td.label { width: 48%; padding: 6pt 8pt; }
  .block td.input { width: 52%; padding: 4pt 8pt; }
  .block input[type="text"]{ width: 100%; border: none; outline: none; font: inherit; padding: 0; }

  /* ====== ATHLETES TABLE ====== */
  .tbl th, .tbl td { border:1px solid #000; padding: 4pt 6pt; font-size: 12.5pt; vertical-align: top; }
  .tbl thead th { text-align: left; }
  .tbl .col-n { width: 10mm; text-align:center; }
  .tbl .col-fio { width: 64mm; }
  .tbl .col-year { width: 24mm; text-align:center; }
  .tbl .col-has { width: 28mm; }
  .tbl .col-perf { width: 28mm; }
  .tbl .col-doc { width: 34mm; }
  input, select { font: inherit; }
  input[type="number"] { width: 100%; border: none; outline: none; }
  select { width: 100%; border: none; outline: none; background: transparent; }
  .controls { display:flex; gap:8px; margin: 10pt 0; }
  button { font: inherit; padding: 6pt 10pt; border:1px solid #000; background:#fff; cursor: pointer; }
  button.primary { background:#000; color:#fff; }
  .no-print { }
  @media print {
    .no-print { display:none !important; }
    .line-input { border-bottom: 1px solid #000; } /* видно линию */
  }
</style>
</head>
<body>
<div class="page">
  <div class="header-row">
    <div></div>
    <div class="header-right">
      <div class="app-note">ПРИЛОЖЕНИЕ №1</div>
      <div class="date-line small">
        Дата: « <input class="line-input" name="date_day" maxlength="2" placeholder="дд"> »
        <input class="line-input month" name="date_month" placeholder="месяц">
        <input class="line-input year" name="date_year" value="2025"> г.
      </div>
    </div>
  </div>

  <div class="title">ЗАЯВКА</div>
  <div class="subtitle">на участие в открытом турнире по художественной гимнастике</div>
  <div class="title" style="font-weight: normal; text-decoration: underline;">Акварель Dance</div>
  <div class="city">г. Мытищи, 19 апреля 2025 г.</div>

  <form id="appForm" class="normal">
    <table class="block">
      <tr>
        <td class="label">Название клуба/спортивной школы</td>
        <td class="input"><input name="club" type="text" required></td>
      </tr>
      <tr>
        <td class="label">Город</td>
        <td class="input"><input name="city" type="text" required></td>
      </tr>
      <tr>
        <td class="label">Контакты (телефон, электронная почта)</td>
        <td class="input"><input name="contacts" type="text" required></td>
      </tr>
      <tr>
        <td class="label">Тренер (Ф.И.О.)</td>
        <td class="input"><input name="coach" type="text" required></td>
      </tr>
      <tr>
        <td class="label">Судья (Ф.И.О.), судейская категория</td>
        <td class="input"><input name="judge" type="text"></td>
      </tr>
    </table>

    <div class="section-title" style="font-style: italic; margin-top:10pt;">Индивидуальные упражнения</div>
    <table class="tbl" id="athletesTable">
      <thead>
        <tr>
          <th class="col-n">№<br>п/п</th>
          <th class="col-fio">ФИО гимнастки</th>
          <th class="col-year">Год<br>рождения</th>
          <th class="col-has">Имеет<br>разряд</th>
          <th class="col-perf">Выступает<br>разряд</th>
          <th class="col-doc">Виза врача</th>
          <th class="no-print">Действия</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>

    <div class="controls no-print">
      <button type="button" id="addRow">Добавить участника</button>
      <button type="button" id="printBtn">Скачать PDF</button>
      <span class="small muted">Строк можно добавить сколько угодно</span>
      <div style="margin-left:auto;">
        <button type="submit" class="primary">Отправить в Google Sheets</button>
      </div>
    </div>
  </form>
</div>

<script>
// ===== ВСТАВЬТЕ URL вашего опубликованного Apps Script (Web App) =====
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwPirGeDmIImREC_wwBB2PKwA0sZi1GIXLfnpO-2nCUgVP3ty6kqk8eQ0n8CG6ROzU7/exec";

const tbody = document.getElementById('rows');
const addBtn = document.getElementById('addRow');

function optionList(list){ return list.map(v=>`<option value="${v}">${v}</option>`).join(''); }

function newRow(idx){
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td class="col-n idx">${idx+1}</td>
    <td class="col-fio"><input name="athletes[${idx}][fio]" type="text" required style="width:100%; border:none; outline:none;"></td>
    <td class="col-year"><input name="athletes[${idx}][year]" type="number" min="2005" max="2023" required style="text-align:center; width:100%; border:none; outline:none;"></td>
    <td class="col-has">
      <select name="athletes[${idx}][has_rank]">
        ${optionList(["Нет","III","II","I","КМС","МС"])}
      </select>
    </td>
    <td class="col-perf">
      <select name="athletes[${idx}][perf_rank]">
        ${optionList(["—","III","II","I","КМС","МС"])}
      </select>
    </td>
    <td class="col-doc"><input name="athletes[${idx}][doctor]" type="text" style="width:100%; border:none; outline:none;"></td>
    <td class="no-print"><button type="button" class="remove">Удалить</button></td>`;
  tr.querySelector('.remove')?.addEventListener('click', ()=>{ tr.remove(); renumber(); });
  return tr;
}

function renumber(){
  [...tbody.querySelectorAll('tr')].forEach((tr,i)=>{
    tr.querySelector('.idx').textContent = i+1;
    tr.querySelectorAll('input,select').forEach(el=>{
      const key = el.name.substring(el.name.indexOf('][')+2);
      el.name = `athletes[${i}][${key}`;
    });
  });
}

addBtn.addEventListener('click', ()=> tbody.appendChild(newRow(tbody.children.length)) );
document.getElementById('printBtn').addEventListener('click', ()=> window.print() );
addBtn.click(); // первая строка

document.getElementById('appForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  if(!APPS_SCRIPT_URL || APPS_SCRIPT_URL.startsWith("https://docs.google.com/spreadsheets/d/1_ZnXFJuYrmWXCjgiFhVLFF6TjuRM2-Y9hoI9OENS4wY/edit?gid=0#gid=0")){
    alert("Вставьте URL вашего Apps Script Web App в переменную APPS_SCRIPT_URL");
    return;
  }
  try{
    const fd = new FormData(e.target);
    await fetch(APPS_SCRIPT_URL, { method:'POST', body: fd, mode: 'no-cors' });
    alert("Отправлено! Проверьте Google Sheets.");
  }catch(err){
    console.error(err);
    alert("Ошибка отправки. Проверьте URL веб-приложения.");
  }
});
</script>
</body>
</html>
